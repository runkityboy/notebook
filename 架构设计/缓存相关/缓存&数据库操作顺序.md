### 缓存&数据库操作顺序
对于更新操作，涉及缓存更新、数据库更新。这两个操作是一个原子性操作，如果只成功一半，影响如何？

#### 先操作缓存，再操作数据库
1. delete缓存数据
2. 修改数据库

如果1成功了，2失败了。那么下次来读，会发现缓存为空，从数据库取数据，不会导致数据不一致

#### 先操作数据库，再操作缓存
1. 修改数据库
2. 删除缓存

如果1成功了，2没成功，会导致数据不一致，读取到的是旧数据

#### 结论：对于写操作，要先操作缓存，再操作数据库


### 数据库主从不一致
主库用来更新数据，从库提供读数据。主库更新数据后会发给从库更新，一定会有一个同步延迟。  
如果这段时间对同一个数据先写读，那肯定读到的是旧数据

有如下几种解决方案：
1. 忽略这个不一致，如果业务上能容忍这个不一致，那么最好
2. 强制只读主库，外加缓存提供读效率
3. 选择性读主，在同步延迟期内读主库